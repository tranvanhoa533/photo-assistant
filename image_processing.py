import imagehash
from multiprocessing import Process, Value
from database.tabledef import UserImage
from sqlalchemy.orm import sessionmaker, scoped_session
from sqlalchemy import create_engine, Date
import nmslib
import multiprocessing
from flask import session

import numpy as np
import keras
from keras.applications.mobilenet_v2 import MobileNetV2
from keras.applications.mobilenet_v2 import preprocess_input, decode_predictions

engine = create_engine('sqlite:///ap.db', echo=True)

class ImageProcessing(Process):

    def __init__(self, image_queue):
        super().__init__()
        self.image_queue = image_queue
        self.model = MobileNetV2()
        

    def run(self):

        Session = scoped_session(sessionmaker(bind=engine))
        sess = Session()

        while True:
            id, im = self.image_queue.get()
            hash_raw = imagehash.phash(im).hash.flatten()
            hash_str = ' '.join([str(int(item)) for item in hash_raw])

            im_np = np.expand_dims(np.array(im.convert("RGB").resize((224, 224))), axis=0).astype(np.float)
            im_input = preprocess_input(im_np)
            prediction = self.model.predict(preprocess_input(im_input))
            classid = class_id_map_dict[decode_predictions(prediction)[0][0][1]]

            query = sess.query(UserImage).filter(UserImage.id.in_((id,)))
            user_img = query.first()
            user_img.imghash = hash_str
            user_img.classid = classid
            sess.add(user_img)
            sess.commit()   
            print("************", hash_str, "************")
            print("************", classid, "************")

    def image_clustering(self):
        Session = scoped_session(sessionmaker(bind=engine))
        sess = Session()
        query = sess.query(UserImage).filter(UserImage.userid.in_([session['user_id']]))
        result = query.all()

        user_img_hash = []
        for user_img in result:
            user_img_hash.append(user_img.imghash)

        index = nmslib.init(method='hnsw', 
                            space='bit_hamming', 
                            dtype=nmslib.DistType.INT, 
                            data_type=nmslib.DataType.OBJECT_AS_STRING)

        index.addDataPointBatch(user_img_hash)
        index.createIndex({'post': 2}, print_progress=True)

        k = min(100, len(result))
        num_threads = multiprocessing.cpu_count()
        neighbours = index.knnQueryBatch(user_img_hash, k=k, num_threads=num_threads)

        threshold = 5
        similar = {}
        for i, item in enumerate(neighbours):
            similar[i] = []
            ids, distances = item
            for id, distance in zip(ids, distances):
                if distance <= threshold:
                    if i != id:
                        similar[i].append(id)
                else:
                    break

        groups = [None]*len(result)
        cur_group_id = 0
        for im_id in range(len(result)):
            if groups[im_id] is None:
                groups[im_id] = cur_group_id
                cur_group_id += 1

            for child_im_id in similar[im_id]:
                if groups[child_im_id] is None:
                    groups[child_im_id] = groups[im_id]

        for user_img, group in zip(result, groups):
            user_img.groupid = group
            sess.add(user_img)
        sess.commit()
        
        

def start_process(image_queue):
    process = ImageProcessing(image_queue)
    process.daemon = True
    process.start()

    return process

class_id_map_dict = {'Afghan_hound': 381,
 'African_chameleon': 316,
 'African_crocodile': 802,
 'African_elephant': 550,
 'African_grey': 419,
 'African_hunting_dog': 631,
 'Airedale': 149,
 'American_Staffordshire_terrier': 687,
 'American_alligator': 426,
 'American_black_bear': 221,
 'American_chameleon': 751,
 'American_coot': 465,
 'American_egret': 388,
 'American_lobster': 978,
 'Angora': 430,
 'Appenzeller': 46,
 'Arabian_camel': 914,
 'Arctic_fox': 626,
 'Australian_terrier': 561,
 'Band_Aid': 849,
 'Bedlington_terrier': 71,
 'Bernese_mountain_dog': 374,
 'Blenheim_spaniel': 65,
 'Border_collie': 16,
 'Border_terrier': 171,
 'Boston_bull': 754,
 'Bouvier_des_Flandres': 57,
 'Brabancon_griffon': 773,
 'Brittany_spaniel': 444,
 'CD_player': 789,
 'Cardigan': 750,
 'Chesapeake_Bay_retriever': 169,
 'Chihuahua': 270,
 'Christmas_stocking': 863,
 'Crock_Pot': 356,
 'Dandie_Dinmont': 411,
 'Doberman': 344,
 'Dungeness_crab': 569,
 'Dutch_oven': 511,
 'Egyptian_cat': 482,
 'English_foxhound': 688,
 'English_setter': 502,
 'English_springer': 28,
 'EntleBucher': 567,
 'Eskimo_dog': 707,
 'European_fire_salamander': 379,
 'European_gallinule': 577,
 'French_bulldog': 404,
 'French_horn': 845,
 'French_loaf': 735,
 'German_shepherd': 244,
 'German_short-haired_pointer': 263,
 'Gila_monster': 920,
 'Gordon_setter': 82,
 'Granny_Smith': 432,
 'Great_Dane': 15,
 'Great_Pyrenees': 488,
 'Greater_Swiss_Mountain_dog': 350,
 'Ibizan_hound': 730,
 'Indian_cobra': 382,
 'Indian_elephant': 739,
 'Irish_setter': 874,
 'Irish_terrier': 201,
 'Irish_water_spaniel': 287,
 'Irish_wolfhound': 122,
 'Italian_greyhound': 780,
 'Japanese_spaniel': 200,
 'Kerry_blue_terrier': 268,
 'Komodo_dragon': 603,
 'Labrador_retriever': 809,
 'Lakeland_terrier': 433,
 'Leonberg': 409,
 'Lhasa': 298,
 'Loafer': 54,
 'Madagascar_cat': 918,
 'Maltese_dog': 983,
 'Mexican_hairless': 235,
 'Model_T': 14,
 'Newfoundland': 857,
 'Norfolk_terrier': 504,
 'Norwegian_elkhound': 902,
 'Norwich_terrier': 652,
 'Old_English_sheepdog': 843,
 'Pekinese': 779,
 'Pembroke': 182,
 'Persian_cat': 387,
 'Petri_dish': 218,
 'Polaroid_camera': 36,
 'Pomeranian': 500,
 'Rhodesian_ridgeback': 692,
 'Rottweiler': 612,
 'Saint_Bernard': 613,
 'Saluki': 813,
 'Samoyed': 217,
 'Scotch_terrier': 209,
 'Scottish_deerhound': 74,
 'Sealyham_terrier': 787,
 'Shetland_sheepdog': 637,
 'Shih-Tzu': 820,
 'Siamese_cat': 224,
 'Siberian_husky': 855,
 'Staffordshire_bullterrier': 795,
 'Sussex_spaniel': 384,
 'Tibetan_mastiff': 709,
 'Tibetan_terrier': 724,
 'Walker_hound': 997,
 'Weimaraner': 908,
 'Welsh_springer_spaniel': 662,
 'West_Highland_white_terrier': 729,
 'Windsor_tie': 238,
 'Yorkshire_terrier': 33,
 'abacus': 831,
 'abaya': 937,
 'academic_gown': 365,
 'accordion': 446,
 'acorn': 271,
 'acorn_squash': 968,
 'acoustic_guitar': 715,
 'admiral': 589,
 'affenpinscher': 357,
 'agama': 783,
 'agaric': 537,
 'aircraft_carrier': 256,
 'airliner': 982,
 'airship': 233,
 'albatross': 1,
 'alligator_lizard': 663,
 'alp': 269,
 'altar': 899,
 'ambulance': 972,
 'amphibian': 334,
 'analog_clock': 222,
 'anemone_fish': 32,
 'ant': 121,
 'apiary': 951,
 'apron': 228,
 'armadillo': 699,
 'artichoke': 337,
 'ashcan': 442,
 'assault_rifle': 501,
 'axolotl': 91,
 'baboon': 176,
 'backpack': 690,
 'badger': 893,
 'bagel': 948,
 'bakery': 790,
 'balance_beam': 415,
 'bald_eagle': 339,
 'balloon': 932,
 'ballplayer': 9,
 'ballpoint': 376,
 'banana': 109,
 'banded_gecko': 717,
 'banjo': 748,
 'bannister': 123,
 'barbell': 254,
 'barber_chair': 300,
 'barbershop': 317,
 'barn': 225,
 'barn_spider': 800,
 'barometer': 956,
 'barracouta': 673,
 'barrel': 239,
 'barrow': 194,
 'baseball': 249,
 'basenji': 580,
 'basketball': 585,
 'basset': 828,
 'bassinet': 548,
 'bassoon': 383,
 'bath_towel': 573,
 'bathing_cap': 667,
 'bathtub': 650,
 'beach_wagon': 401,
 'beacon': 56,
 'beagle': 508,
 'beaker': 474,
 'bearskin': 788,
 'beaver': 236,
 'bee': 240,
 'bee_eater': 565,
 'beer_bottle': 436,
 'beer_glass': 83,
 'bell_cote': 538,
 'bell_pepper': 904,
 'bib': 311,
 'bicycle-built-for-two': 391,
 'bighorn': 823,
 'bikini': 973,
 'binder': 366,
 'binoculars': 668,
 'birdhouse': 467,
 'bison': 995,
 'bittern': 183,
 'black-and-tan_coonhound': 570,
 'black-footed_ferret': 811,
 'black_and_gold_garden_spider': 696,
 'black_grouse': 385,
 'black_stork': 988,
 'black_swan': 858,
 'black_widow': 752,
 'bloodhound': 741,
 'bluetick': 786,
 'boa_constrictor': 343,
 'boathouse': 562,
 'bobsled': 355,
 'bolete': 850,
 'bolo_tie': 518,
 'bonnet': 954,
 'book_jacket': 842,
 'bookcase': 399,
 'bookshop': 684,
 'borzoi': 330,
 'bottlecap': 917,
 'bow': 633,
 'bow_tie': 588,
 'box_turtle': 464,
 'boxer': 659,
 'brain_coral': 801,
 'brambling': 326,
 'brass': 292,
 'brassiere': 598,
 'breakwater': 630,
 'breastplate': 593,
 'briard': 458,
 'broccoli': 181,
 'broom': 519,
 'brown_bear': 572,
 'bubble': 666,
 'bucket': 416,
 'buckeye': 531,
 'buckle': 962,
 'bulbul': 185,
 'bull_mastiff': 108,
 'bullet_train': 686,
 'bulletproof_vest': 720,
 'bullfrog': 313,
 'burrito': 660,
 'bustard': 246,
 'butcher_shop': 586,
 'butternut_squash': 781,
 'cab': 728,
 'cabbage_butterfly': 835,
 'cairn': 710,
 'caldron': 400,
 'can_opener': 277,
 'candle': 799,
 'cannon': 808,
 'canoe': 910,
 'capuchin': 507,
 'car_mirror': 742,
 'car_wheel': 736,
 'carbonara': 870,
 'cardigan': 378,
 'cardoon': 574,
 'carousel': 935,
 "carpenter's_kit": 533,
 'carton': 478,
 'cash_machine': 336,
 'cassette': 977,
 'cassette_player': 873,
 'castle': 928,
 'catamaran': 640,
 'cauliflower': 564,
 'cello': 840,
 'cellular_telephone': 838,
 'centipede': 21,
 'chain': 476,
 'chain_mail': 278,
 'chain_saw': 738,
 'chainlink_fence': 810,
 'chambered_nautilus': 655,
 'cheeseburger': 905,
 'cheetah': 930,
 'chest': 13,
 'chickadee': 909,
 'chiffonier': 515,
 'chime': 794,
 'chimpanzee': 798,
 'china_cabinet': 310,
 'chiton': 480,
 'chocolate_sauce': 957,
 'chow': 148,
 'church': 10,
 'cicada': 784,
 'cinema': 241,
 'cleaver': 438,
 'cliff': 178,
 'cliff_dwelling': 777,
 'cloak': 408,
 'clog': 62,
 'clumber': 40,
 'cock': 496,
 'cocker_spaniel': 73,
 'cockroach': 535,
 'cocktail_shaker': 958,
 'coffee_mug': 102,
 'coffeepot': 195,
 'coho': 396,
 'coil': 583,
 'collie': 154,
 'colobus': 11,
 'combination_lock': 927,
 'comic_book': 342,
 'common_iguana': 191,
 'common_newt': 101,
 'computer_keyboard': 495,
 'conch': 671,
 'confectionery': 202,
 'consomme': 915,
 'container_ship': 523,
 'convertible': 144,
 'coral_fungus': 866,
 'coral_reef': 492,
 'corkscrew': 234,
 'corn': 976,
 'cornet': 691,
 'coucal': 219,
 'cougar': 601,
 'cowboy_boot': 629,
 'cowboy_hat': 844,
 'coyote': 513,
 'cradle': 199,
 'crane': 363,
 'crash_helmet': 698,
 'crate': 459,
 'crayfish': 594,
 'crib': 24,
 'cricket': 231,
 'croquet_ball': 694,
 'crossword_puzzle': 220,
 'crutch': 897,
 'cucumber': 737,
 'cuirass': 80,
 'cup': 61,
 'curly-coated_retriever': 628,
 'custard_apple': 441,
 'daisy': 805,
 'dalmatian': 417,
 'dam': 251,
 'damselfly': 543,
 'desk': 947,
 'desktop_computer': 139,
 'dhole': 883,
 'dial_telephone': 184,
 'diamondback': 262,
 'diaper': 282,
 'digital_clock': 912,
 'digital_watch': 785,
 'dingo': 322,
 'dining_table': 338,
 'dishrag': 299,
 'dishwasher': 599,
 'disk_brake': 774,
 'dock': 670,
 'dogsled': 645,
 'dome': 472,
 'doormat': 520,
 'dough': 425,
 'dowitcher': 439,
 'dragonfly': 591,
 'drake': 806,
 'drilling_platform': 159,
 'drum': 747,
 'drumstick': 204,
 'dugong': 961,
 'dumbbell': 916,
 'dung_beetle': 49,
 'ear': 880,
 'earthstar': 697,
 'echidna': 723,
 'eel': 898,
 'eft': 17,
 'eggnog': 896,
 'electric_fan': 993,
 'electric_guitar': 485,
 'electric_locomotive': 853,
 'electric_ray': 996,
 'entertainment_center': 354,
 'envelope': 447,
 'espresso': 782,
 'espresso_maker': 816,
 'face_powder': 242,
 'feather_boa': 70,
 'fiddler_crab': 878,
 'fig': 281,
 'file': 7,
 'fire_engine': 704,
 'fire_screen': 889,
 'fireboat': 142,
 'flagpole': 946,
 'flamingo': 755,
 'flat-coated_retriever': 969,
 'flatworm': 325,
 'flute': 223,
 'fly': 815,
 'folding_chair': 206,
 'football_helmet': 104,
 'forklift': 653,
 'fountain': 390,
 'fountain_pen': 886,
 'four-poster': 198,
 'fox_squirrel': 859,
 'freight_car': 258,
 'frilled_lizard': 372,
 'frying_pan': 22,
 'fur_coat': 493,
 'gar': 542,
 'garbage_truck': 6,
 'garden_spider': 841,
 'garter_snake': 689,
 'gas_pump': 627,
 'gasmask': 529,
 'gazelle': 120,
 'geyser': 546,
 'giant_panda': 619,
 'giant_schnauzer': 895,
 'gibbon': 448,
 'go-kart': 23,
 'goblet': 834,
 'golden_retriever': 4,
 'goldfinch': 994,
 'goldfish': 765,
 'golf_ball': 25,
 'golfcart': 306,
 'gondola': 836,
 'gong': 892,
 'goose': 888,
 'gorilla': 177,
 'gown': 229,
 'grand_piano': 925,
 'grasshopper': 837,
 'great_grey_owl': 276,
 'great_white_shark': 953,
 'green_lizard': 814,
 'green_mamba': 767,
 'green_snake': 226,
 'greenhouse': 66,
 'grey_fox': 369,
 'grey_whale': 440,
 'grille': 3,
 'grocery_store': 132,
 'groenendael': 706,
 'groom': 95,
 'ground_beetle': 479,
 'guacamole': 58,
 'guenon': 775,
 'guillotine': 611,
 'guinea_pig': 716,
 'gyromitra': 457,
 'hair_slide': 617,
 'hair_spray': 884,
 'half_track': 126,
 'hammer': 566,
 'hammerhead': 302,
 'hamper': 345,
 'hamster': 332,
 'hand-held_computer': 609,
 'hand_blower': 215,
 'handkerchief': 568,
 'hard_disc': 604,
 'hare': 303,
 'harmonica': 491,
 'harp': 510,
 'hartebeest': 984,
 'harvester': 530,
 'harvestman': 380,
 'hatchet': 876,
 'hay': 443,
 'head_cabbage': 63,
 'hen': 756,
 'hen-of-the-woods': 64,
 'hermit_crab': 320,
 'hip': 172,
 'hippopotamus': 297,
 'hog': 971,
 'hognose_snake': 75,
 'holster': 551,
 'home_theater': 852,
 'honeycomb': 371,
 'hook': 305,
 'hoopskirt': 99,
 'horizontal_bar': 286,
 'hornbill': 392,
 'horned_viper': 732,
 'horse_cart': 92,
 'hot_pot': 989,
 'hotdog': 294,
 'hourglass': 395,
 'house_finch': 771,
 'howler_monkey': 37,
 'hummingbird': 290,
 'hyena': 743,
 'iPod': 950,
 'ibex': 103,
 'ice_bear': 963,
 'ice_cream': 924,
 'ice_lolly': 445,
 'impala': 745,
 'indigo_bunting': 693,
 'indri': 778,
 'iron': 421,
 'isopod': 131,
 'jacamar': 463,
 "jack-o'-lantern": 60,
 'jackfruit': 331,
 'jaguar': 210,
 'jay': 180,
 'jean': 477,
 'jeep': 540,
 'jellyfish': 362,
 'jersey': 422,
 'jigsaw_puzzle': 69,
 'jinrikisha': 651,
 'joystick': 145,
 'junco': 620,
 'keeshond': 647,
 'kelpie': 189,
 'killer_whale': 582,
 'kimono': 158,
 'king_crab': 822,
 'king_penguin': 160,
 'king_snake': 90,
 'kit_fox': 826,
 'kite': 839,
 'knee_pad': 250,
 'knot': 428,
 'koala': 394,
 'komondor': 373,
 'kuvasz': 279,
 'lab_coat': 682,
 'lacewing': 361,
 'ladle': 575,
 'ladybug': 364,
 'lakeside': 685,
 'lampshade': 187,
 'langur': 658,
 'laptop': 657,
 'lawn_mower': 481,
 'leaf_beetle': 135,
 'leafhopper': 733,
 'leatherback_turtle': 414,
 'lemon': 301,
 'lens_cap': 560,
 'leopard': 77,
 'lesser_panda': 349,
 'letter_opener': 819,
 'library': 536,
 'lifeboat': 248,
 'lighter': 327,
 'limousine': 403,
 'limpkin': 196,
 'liner': 887,
 'lion': 146,
 'lionfish': 205,
 'lipstick': 705,
 'little_blue_heron': 681,
 'llama': 203,
 'loggerhead': 661,
 'long-horned_beetle': 597,
 'lorikeet': 129,
 'lotion': 397,
 'loudspeaker': 595,
 'loupe': 437,
 'lumbermill': 643,
 'lycaenid': 606,
 'lynx': 871,
 'macaque': 642,
 'macaw': 579,
 'magnetic_compass': 669,
 'magpie': 634,
 'mailbag': 188,
 'mailbox': 679,
 'maillot': 614,
 'malamute': 471,
 'malinois': 955,
 'manhole_cover': 532,
 'mantis': 498,
 'maraca': 138,
 'marimba': 27,
 'marmoset': 907,
 'marmot': 328,
 'mashed_potato': 512,
 'mask': 759,
 'matchstick': 975,
 'maypole': 5,
 'maze': 711,
 'measuring_cup': 578,
 'meat_loaf': 273,
 'medicine_chest': 499,
 'meerkat': 792,
 'megalith': 934,
 'menu': 894,
 'microphone': 452,
 'microwave': 625,
 'military_uniform': 554,
 'milk_can': 165,
 'miniature_pinscher': 450,
 'miniature_poodle': 949,
 'miniature_schnauzer': 261,
 'minibus': 559,
 'miniskirt': 830,
 'minivan': 168,
 'mink': 862,
 'missile': 461,
 'mitten': 375,
 'mixing_bowl': 942,
 'mobile_home': 584,
 'modem': 30,
 'monarch': 877,
 'monastery': 514,
 'mongoose': 127,
 'monitor': 113,
 'moped': 346,
 'mortar': 289,
 'mortarboard': 615,
 'mosque': 900,
 'mosquito_net': 486,
 'motor_scooter': 173,
 'mountain_bike': 702,
 'mountain_tent': 596,
 'mouse': 960,
 'mousetrap': 100,
 'moving_van': 875,
 'mud_turtle': 214,
 'mushroom': 944,
 'muzzle': 370,
 'nail': 753,
 'neck_brace': 130,
 'necklace': 312,
 'nematode': 526,
 'night_snake': 174,
 'nipple': 938,
 'notebook': 86,
 'obelisk': 772,
 'oboe': 933,
 'ocarina': 590,
 'odometer': 272,
 'oil_filter': 475,
 'orange': 656,
 'orangutan': 454,
 'organ': 600,
 'oscilloscope': 179,
 'ostrich': 555,
 'otter': 864,
 'otterhound': 341,
 'overskirt': 981,
 'ox': 161,
 'oxcart': 112,
 'oxygen_mask': 48,
 'oystercatcher': 556,
 'packet': 367,
 'paddle': 105,
 'paddlewheel': 616,
 'padlock': 903,
 'paintbrush': 156,
 'pajama': 140,
 'palace': 979,
 'panpipe': 155,
 'paper_towel': 675,
 'papillon': 193,
 'parachute': 648,
 'parallel_bars': 922,
 'park_bench': 776,
 'parking_meter': 418,
 'partridge': 424,
 'passenger_car': 43,
 'patas': 67,
 'patio': 761,
 'pay-phone': 141,
 'peacock': 587,
 'pedestal': 133,
 'pelican': 769,
 'pencil_box': 791,
 'pencil_sharpener': 116,
 'perfume': 51,
 'photocopier': 545,
 'pick': 264,
 'pickelhaube': 309,
 'picket_fence': 804,
 'pickup': 323,
 'pier': 623,
 'piggy_bank': 674,
 'pill_bottle': 87,
 'pillow': 351,
 'pineapple': 911,
 'ping-pong_ball': 153,
 'pinwheel': 423,
 'pirate': 253,
 'pitcher': 50,
 'pizza': 484,
 'plane': 970,
 'planetarium': 255,
 'plastic_bag': 505,
 'plate': 151,
 'plate_rack': 314,
 'platypus': 393,
 'plow': 143,
 'plunger': 288,
 'pole': 59,
 'polecat': 906,
 'police_van': 665,
 'pomegranate': 592,
 'poncho': 746,
 'pool_table': 243,
 'pop_bottle': 329,
 'porcupine': 412,
 'pot': 803,
 'potpie': 429,
 "potter's_wheel": 901,
 'power_drill': 284,
 'prairie_chicken': 207,
 'prayer_rug': 636,
 'pretzel': 608,
 'printer': 360,
 'prison': 97,
 'proboscis_monkey': 921,
 'projectile': 943,
 'projector': 0,
 'promontory': 980,
 'ptarmigan': 807,
 'puck': 468,
 'puffer': 453,
 'pug': 42,
 'punching_bag': 757,
 'purse': 768,
 'quail': 216,
 'quill': 190,
 'quilt': 749,
 'racer': 52,
 'racket': 541,
 'radiator': 945,
 'radio': 98,
 'radio_telescope': 703,
 'rain_barrel': 45,
 'ram': 427,
 'rapeseed': 740,
 'recreational_vehicle': 632,
 'red-backed_sandpiper': 324,
 'red-breasted_merganser': 128,
 'red_fox': 509,
 'red_wine': 727,
 'red_wolf': 941,
 'redbone': 335,
 'redshank': 812,
 'reel': 602,
 'reflex_camera': 936,
 'refrigerator': 410,
 'remote_control': 890,
 'restaurant': 291,
 'revolver': 986,
 'rhinoceros_beetle': 700,
 'rifle': 29,
 'ringlet': 469,
 'ringneck_snake': 607,
 'robin': 39,
 'rock_beauty': 695,
 'rock_crab': 635,
 'rock_python': 654,
 'rocking_chair': 333,
 'rotisserie': 762,
 'rubber_eraser': 713,
 'ruddy_turnstone': 605,
 'ruffed_grouse': 547,
 'rugby_ball': 347,
 'rule': 119,
 'running_shoe': 227,
 'safe': 434,
 'safety_pin': 926,
 'saltshaker': 744,
 'sandal': 544,
 'sandbar': 293,
 'sarong': 516,
 'sax': 318,
 'scabbard': 964,
 'scale': 683,
 'schipperke': 563,
 'school_bus': 115,
 'schooner': 162,
 'scoreboard': 576,
 'scorpion': 147,
 'screen': 817,
 'screw': 714,
 'screwdriver': 528,
 'scuba_diver': 503,
 'sea_anemone': 734,
 'sea_cucumber': 869,
 'sea_lion': 726,
 'sea_slug': 517,
 'sea_snake': 94,
 'sea_urchin': 315,
 'seashore': 721,
 'seat_belt': 929,
 'sewing_machine': 319,
 'shield': 451,
 'shoe_shop': 308,
 'shoji': 232,
 'shopping_basket': 89,
 'shopping_cart': 175,
 'shovel': 186,
 'shower_cap': 267,
 'shower_curtain': 455,
 'siamang': 213,
 'sidewinder': 764,
 'silky_terrier': 93,
 'ski': 985,
 'ski_mask': 280,
 'skunk': 96,
 'sleeping_bag': 353,
 'slide_rule': 851,
 'sliding_door': 110,
 'slot': 494,
 'sloth_bear': 407,
 'slug': 610,
 'snail': 992,
 'snorkel': 856,
 'snow_leopard': 824,
 'snowmobile': 867,
 'snowplow': 965,
 'soap_dispenser': 84,
 'soccer_ball': 460,
 'sock': 359,
 'soft-coated_wheaten_terrier': 991,
 'solar_dish': 466,
 'sombrero': 758,
 'sorrel': 708,
 'soup_bowl': 719,
 'space_bar': 134,
 'space_heater': 377,
 'space_shuttle': 483,
 'spaghetti_squash': 117,
 'spatula': 821,
 'speedboat': 525,
 'spider_monkey': 449,
 'spider_web': 641,
 'spindle': 348,
 'spiny_lobster': 489,
 'spoonbill': 47,
 'sports_car': 818,
 'spotlight': 552,
 'spotted_salamander': 882,
 'squirrel_monkey': 81,
 'stage': 106,
 'standard_poodle': 192,
 'standard_schnauzer': 557,
 'starfish': 919,
 'steam_locomotive': 718,
 'steel_arch_bridge': 197,
 'steel_drum': 846,
 'stethoscope': 157,
 'stingray': 402,
 'stinkhorn': 987,
 'stole': 497,
 'stone_wall': 285,
 'stopwatch': 405,
 'stove': 237,
 'strainer': 967,
 'strawberry': 114,
 'street_sign': 19,
 'streetcar': 111,
 'stretcher': 72,
 'studio_couch': 2,
 'stupa': 553,
 'sturgeon': 230,
 'submarine': 20,
 'suit': 34,
 'sulphur-crested_cockatoo': 527,
 'sulphur_butterfly': 266,
 'sundial': 124,
 'sunglass': 431,
 'sunglasses': 847,
 'sunscreen': 534,
 'suspension_bridge': 456,
 'swab': 473,
 'sweatshirt': 137,
 'swimming_trunks': 624,
 'swing': 150,
 'switch': 712,
 'syringe': 487,
 'tabby': 252,
 'table_lamp': 212,
 'tailed_frog': 35,
 'tank': 398,
 'tape_player': 296,
 'tarantula': 247,
 'teapot': 865,
 'teddy': 340,
 'television': 167,
 'tench': 861,
 'tennis_ball': 68,
 'terrapin': 966,
 'thatch': 939,
 'theater_curtain': 913,
 'thimble': 245,
 'three-toed_sloth': 923,
 'thresher': 649,
 'throne': 796,
 'thunder_snake': 307,
 'tick': 152,
 'tiger': 41,
 'tiger_beetle': 125,
 'tiger_cat': 352,
 'tiger_shark': 581,
 'tile_roof': 872,
 'timber_wolf': 722,
 'titi': 274,
 'toaster': 462,
 'tobacco_shop': 304,
 'toilet_seat': 959,
 'toilet_tissue': 848,
 'torch': 118,
 'totem_pole': 76,
 'toucan': 257,
 'tow_truck': 107,
 'toy_poodle': 952,
 'toy_terrier': 44,
 'toyshop': 639,
 'tractor': 558,
 'traffic_light': 208,
 'trailer_truck': 571,
 'tray': 549,
 'tree_frog': 38,
 'trench_coat': 389,
 'triceratops': 644,
 'tricycle': 163,
 'trifle': 539,
 'trilobite': 793,
 'trimaran': 990,
 'tripod': 211,
 'triumphal_arch': 833,
 'trolleybus': 860,
 'trombone': 974,
 'tub': 55,
 'turnstile': 760,
 'tusker': 885,
 'typewriter_keyboard': 295,
 'umbrella': 420,
 'unicycle': 676,
 'upright': 79,
 'vacuum': 386,
 'valley': 521,
 'vase': 763,
 'vault': 646,
 'velvet': 638,
 'vending_machine': 88,
 'vestment': 26,
 'viaduct': 53,
 'vine_snake': 701,
 'violin': 368,
 'vizsla': 879,
 'volcano': 470,
 'volleyball': 770,
 'vulture': 832,
 'waffle_iron': 868,
 'walking_stick': 522,
 'wall_clock': 18,
 'wallaby': 78,
 'wallet': 435,
 'wardrobe': 490,
 'warplane': 31,
 'warthog': 725,
 'washbasin': 406,
 'washer': 358,
 'water_bottle': 321,
 'water_buffalo': 283,
 'water_jug': 170,
 'water_ouzel': 672,
 'water_snake': 731,
 'water_tower': 164,
 'weasel': 524,
 'web_site': 677,
 'weevil': 664,
 'whippet': 618,
 'whiptail': 622,
 'whiskey_jug': 931,
 'whistle': 413,
 'white_stork': 940,
 'white_wolf': 854,
 'wig': 891,
 'wild_boar': 12,
 'window_screen': 881,
 'window_shade': 827,
 'wine_bottle': 680,
 'wing': 259,
 'wire-haired_fox_terrier': 506,
 'wok': 265,
 'wolf_spider': 260,
 'wombat': 275,
 'wood_rabbit': 8,
 'wooden_spoon': 85,
 'wool': 678,
 'worm_fence': 797,
 'wreck': 621,
 'yawl': 766,
 "yellow_lady's_slipper": 825,
 'yurt': 166,
 'zebra': 829,
 'zucchini': 136}